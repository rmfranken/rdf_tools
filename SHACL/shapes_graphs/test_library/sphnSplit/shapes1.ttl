@prefix : <https://biomedit.ch/rdf/sphn-ontology/sphn#> .
@prefix chop: <https://biomedit.ch/rdf/sphn-resource/chop/> .
@prefix constraints: <https://biomedit.ch/rdf/sphn-ontology-constraints/sphn#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix icd-10-gm: <https://biomedit.ch/rdf/sphn-resource/icd-10-gm/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix snomed: <http://snomed.info/id/> .
@prefix sphn-atc: <https://biomedit.ch/rdf/sphn-resource/atc/> .
@prefix sphn-loinc: <https://biomedit.ch/rdf/sphn-resource/loinc/> .
@prefix ucum: <https://biomedit.ch/rdf/sphn-resource/ucum/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

constraints: a owl:Ontology ;
    dct:created "2022-07-20"^^xsd:date ;
    dct:license <https://creativecommons.org/licenses/by/4.0/> ;
    rdfs:comment "Generated by the the SHACLer tool, that is developed by the SPHN DCC (PHI, SIB Swiss Institute of Bioinformatics): https://git.dcc.sib.swiss/sphn-semantic-framework/sphn-shacl-generator"^^xsd:string ;
    owl:versionIRI <https://biomedit.ch/rdf/sphn-ontology/sphn/2022/2> ;
    sh:entailment <http://www.w3.org/ns/entailment/RDFS> .

constraints:AdministrativeCase a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property [ sh:datatype xsd:dateTime ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasAdmissionDateTime ],
        [ sh:datatype xsd:dateTime ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasDischargeDateTime ],
        [ sh:class :Location ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasOriginLocation ],
        [ sh:class :Location ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasDischargeLocation ],
        [ sh:class :CareHandling ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasCareHandling ],
        [ sh:class :DataProviderInstitute ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasDataProviderInstitute ],
        [ sh:datatype xsd:string ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasIdentifier ],
        [ sh:class :SubjectPseudoIdentifier ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasSubjectPseudoIdentifier ] ;
    sh:targetClass :AdministrativeCase .

constraints:AdministrativeGender a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property [ sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:or ( [ sh:class snomed:703117000 ] [ sh:class snomed:74964007 ] [ sh:class snomed:261665006 ] [ sh:class snomed:703118005 ] ) ;
            sh:path :hasCode ],
        [ sh:class :SubjectPseudoIdentifier ;
            sh:minCount 1 ;
            sh:path :hasSubjectPseudoIdentifier ],
        [ sh:datatype xsd:dateTime ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasRecordDateTime ] ;
    sh:sparql [ a sh:SPARQLConstraint ;
            sh:message "No subclasses of the specified codes are allowed" ;
            sh:select """
                                        SELECT ?this (<https://biomedit.ch/rdf/sphn-ontology/sphn#hasCode> as ?path) (?class as ?value)
                                        WHERE {
                                        ?this <https://biomedit.ch/rdf/sphn-ontology/sphn#hasCode>/<http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?class .
                                        FILTER (?class NOT IN (<http://snomed.info/id/703117000>,<http://snomed.info/id/74964007>,<http://snomed.info/id/261665006>,<http://snomed.info/id/703118005>) ) .
FILTER NOT EXISTS {<http://snomed.info/id/703117000> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/74964007> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/261665006> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/703118005> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
}""" ] ;
    sh:targetClass :AdministrativeGender .

constraints:AdverseEvent a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property [ sh:class :AdverseEvent_outcome ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasOutcome ],
        [ sh:class :SubjectPseudoIdentifier ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasSubjectPseudoIdentifier ],
        [ sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:or ( [ sh:class :Terminology ] [ sh:class :Code ] ) ;
            sh:path :hasSeverityCode ],
        [ sh:datatype xsd:string ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasIntervention ],
        [ sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:or ( [ sh:class :Terminology ] [ sh:class :Code ] ) ;
            sh:path :hasCode ],
        [ sh:class :AdministrativeCase ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasAdministrativeCase ],
        [ sh:class :AdverseEvent_consequences ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasConsequences ],
        [ sh:datatype xsd:dateTime ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasOnsetDateTime ],
        [ sh:class :DataProviderInstitute ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasDataProviderInstitute ] ;
    sh:targetClass :AdverseEvent .

constraints:AdverseEvent_consequences a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property [ sh:in ( :PermanentDamageOrDisability :LifeThreatening :HospitalisationOrProlongation :NoneOfTheConsequencesMentioned :CongenitalAbnormality :TemporarilySeriousImpactMedicallyImportant :Death ) ;
            sh:path [ sh:inversePath rdf:type ] ] ;
    sh:targetClass :AdverseEvent_consequences .

constraints:AdverseEvent_outcome a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property [ sh:in ( :NotRecovered :RecoveringWithSequelae :Recovering :Unknown :Fatal :Recovered ) ;
            sh:path [ sh:inversePath rdf:type ] ] ;
    sh:targetClass :AdverseEvent_outcome .

constraints:Age a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property [ sh:class :SubjectPseudoIdentifier ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasSubjectPseudoIdentifier ],
        [ sh:in ( ucum:wk ucum:d ucum:h ucum:a ucum:mo ucum:min ) ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path ( :hasQuantity :hasUnit :hasCode ) ],
        [ sh:datatype xsd:dateTime ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasDeterminationDateTime ] ;
    sh:targetClass :Age .

constraints:Allergy a sh:NodeShape ;
    sh:closed false ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property [ sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:or ( [ sh:class snomed:723510000 ] [ sh:class snomed:415684004 ] [ sh:class snomed:410605003 ] [ sh:class snomed:723511001 ] ) ;
            sh:path :hasVerificationStatusCode ],
        [ sh:class :Substance ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasSubstance ],
        [ sh:datatype xsd:dateTime ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasLastReactionDateTime ],
        [ sh:class :Allergy_substanceCategory ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasSubstanceCategory ],
        [ sh:class :SubjectPseudoIdentifier ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasSubjectPseudoIdentifier ],
        [ sh:class :DataProviderInstitute ;
            sh:maxCount 1 ;
            sh:minCount 1 ;
            sh:path :hasDataProviderInstitute ],
        [ sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:or ( [ sh:class snomed:723505004 ] [ sh:class snomed:723507007 ] [ sh:class snomed:723509005 ] ) ;
            sh:path :hasSeverityCode ],
        [ sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:or ( [ sh:class snomed:782197009 ] [ sh:class snomed:419199007 ] [ sh:class snomed:261665006 ] ) ;
            sh:path :hasReactionTypeCode ],
        [ sh:datatype xsd:dateTime ;
            sh:maxCount 1 ;
            sh:minCount 0 ;
            sh:path :hasFirstRecordDateTime ] ;
    sh:sparql [ a sh:SPARQLConstraint ;
            sh:message "No subclasses of the specified codes are allowed" ;
            sh:select """
                                        SELECT ?this (<https://biomedit.ch/rdf/sphn-ontology/sphn#hasSeverityCode> as ?path) (?class as ?value)
                                        WHERE {
                                        ?this <https://biomedit.ch/rdf/sphn-ontology/sphn#hasSeverityCode>/<http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?class .
                                        FILTER (?class NOT IN (<http://snomed.info/id/723505004>,<http://snomed.info/id/723507007>,<http://snomed.info/id/723509005>) ) .
FILTER NOT EXISTS {<http://snomed.info/id/723505004> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/723507007> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/723509005> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
}""" ],
        [ a sh:SPARQLConstraint ;
            sh:message "No subclasses of the specified codes are allowed" ;
            sh:select """
                                        SELECT ?this (<https://biomedit.ch/rdf/sphn-ontology/sphn#hasReactionTypeCode> as ?path) (?class as ?value)
                                        WHERE {
                                        ?this <https://biomedit.ch/rdf/sphn-ontology/sphn#hasReactionTypeCode>/<http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?class .
                                        FILTER (?class NOT IN (<http://snomed.info/id/782197009>,<http://snomed.info/id/419199007>,<http://snomed.info/id/261665006>) ) .
FILTER NOT EXISTS {<http://snomed.info/id/782197009> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/419199007> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/261665006> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
}""" ],
        [ a sh:SPARQLConstraint ;
            sh:message "No subclasses of the specified codes are allowed" ;
            sh:select """
                                        SELECT ?this (<https://biomedit.ch/rdf/sphn-ontology/sphn#hasVerificationStatusCode> as ?path) (?class as ?value)
                                        WHERE {
                                        ?this <https://biomedit.ch/rdf/sphn-ontology/sphn#hasVerificationStatusCode>/<http://www.w3.org/1999/02/22-rdf-syntax-ns#type> ?class .
                                        FILTER (?class NOT IN (<http://snomed.info/id/723510000>,<http://snomed.info/id/415684004>,<http://snomed.info/id/410605003>,<http://snomed.info/id/723511001>) ) .
FILTER NOT EXISTS {<http://snomed.info/id/723510000> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/415684004> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/410605003> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
FILTER NOT EXISTS {<http://snomed.info/id/723511001> <http://www.w3.org/2000/01/rdf-schema#subClassOf>+ ?class .}
}""" ] ;
    sh:targetClass :Allergy .
